---
layout: v022
title: "UserFrosting: Backend AJAX API"
---
  <div class='alert alert-info'>This page is incomplete.</div>  
<h1>Backend AJAX API</h1>

<p class="lead">
These are pages which accept a POST or GET request (usually via AJAX), perform some action, and then return a response in the form of a JSON object.  All backend api pages are stored in the <code>api</code> directory.  Success, error, and warning messages are sent to the <a href="{{site.url}}/0.2.2/features#errors">alert stream</a>, and can be accessed via <code>api/user_alerts.php</code>.
</p>

<div class="panel-group" id="api_pages">
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#api_pages" href="#activate_account">
          activate_account.php
        </a>
      </h4>
    </div>
    <div id="activate_account" class="panel-collapse collapse in">
      <div class="panel-body">
        <p class="lead">
        Activates a newly registered user account, using the activation token that was emailed to the user upon account registration or user's <code>user_id</code> (<code>id</code> column in <code>users</code>).
        </p>
        <p><strong>Login required: </strong>no</p>
        <p><strong>GET request</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>[token]</code></td><td>The user's activation token, as generated during account registration or after a resend activation request.</td></tr>
        <tr><td><code>[user_id]</code></td><td>The user's id.  Used for admins to bypass the activation token and directly activate a user's account.</td></tr>
        <tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
        </tbody>
        </table>
        <p><strong>GET response</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
        <tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
        </tbody>
        </table>    
        <p><strong>Possible alerts generated</strong></p>
        <ul class="list-group">
            <li class="list-group-item"><code>ACCOUNT_INVALID_USER_ID</code> : Invalid user_id specified.</li>
            <li class="list-group-item"><code>ACCOUNT_TOKEN_NOT_FOUND</code> : Invalid token specified.</li>
            <li class="list-group-item"><code>SQL_ERROR</code> : Database error.</li>
            <li class="list-group-item"><code>ACCOUNT_ACTIVATION_COMPLETE</code> : Account successfully activated.</li>
            <li class="list-group-item"><code>ACCOUNT_MANUALLY_ACTIVATED</code> : Manual account activation successful.</li>
            <li class="list-group-item">Authorization failed</li>            
        </ul>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#api_pages" href="#create_action_permit">
          create_action_permit.php
        </a>
      </h4>
    </div>
    <div id="create_action_permit" class="panel-collapse collapse">
      <div class="panel-body">
        <p class="lead">
        Adds a new <a href="features.html#authorization">action-permit mapping</a> for a user or group.
        </p>
        <p><strong>Login required: </strong>yes</p>
        <p><strong>POST request</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>action_name</code></td><td>The name of the secure action to be added for the specified user/group.</td></tr>
        <tr><td><code>permit</code></td><td>A string of permit validators, joined by <code>&</code>.</td></tr>
        <tr><td><code>[group_id]</code></td><td>If specified, the action-permit mapping will be added for this group.</td></tr>
        <tr><td><code>[user_id]</code></td><td>If specified, the action-permit mapping will be added for this user.</td></tr>
        <tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
        </tbody>
        </table>
        <p><strong>POST response</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
        <tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
        </tbody>
        </table>    
        <p><strong>Possible alerts generated</strong></p>
        <ul class="list-group">
            <li class="list-group-item">Invalid user_id specified.</li>
            <li class="list-group-item">Invalid token specified.</li>
            <li class="list-group-item"><code>SQL_ERROR</code> : Database error.</li>
            <li class="list-group-item">Invalid action specified.</li>
            <li class="list-group-item">Invalid permit(s) specified.</li>
            <li class="list-group-item">Authorization failed</li>            
        </ul>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#api_pages" href="#create_group">
          create_group.php
        </a>
      </h4>
    </div>
    <div id="create_group" class="panel-collapse collapse">
      <div class="panel-body">
        <p class="lead">
        Create a new <a href="components.html#groups">group</a>.
        </p>
        <p><strong>Login required: </strong>yes</p>
        <p><strong>POST request</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>group_name</code></td><td>The name of the new group.</td></tr>
        <tr><td><code>home_page_id</code></td><td>The id of the page (as specified in the <code>pages</code> database table) to use as the group's home page.</td></tr>
        <tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
        </tbody>
        </table>
        <p><strong>POST response</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
        <tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
        </tbody>
        </table>    
        <p><strong>Possible alerts generated</strong></p>
        <ul class="list-group">
            <li class="list-group-item"><code>PERMISSION_NAME_IN_USE</code> : Group name already in use.</li>
            <li class="list-group-item"><code>PERMISSION_CHAR_LIMIT</code> : Group name too short/long.</li>
            <li class="list-group-item"><code>PERMISSION_CREATION_SUCCESSFUL</code> : Group successfully created.</li>
            <li class="list-group-item"><code>SQL_ERROR</code> : Database error.</li>
            <li class="list-group-item">Authorization failed</li>
        </ul>
      </div>
    </div>
  </div>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#api_pages" href="#create_user">
          create_user.php
        </a>
      </h4>
    </div>
    <div id="create_user" class="panel-collapse collapse">
      <div class="panel-body">
        <p class="lead">
        Create a new <a href="components.html#users">user</a>.
        </p>
        <p><strong>Login required: </strong>sometimes</p>
        <p>This page can be accessed in admin or registration mode.  If accessed in admin mode, authorization for the <code>createUser</code> secure function will be required, and the session <a href="security.html#csrf">CSRF token</a> must be supplied.  Otherwise, a new user account can be self-registered if registration is enabled in the <strong>site settings</strong>.  In registration mode, all default groups will be added for the new user.  Will fail if the root account has not yet been created.</p>
        <p><strong>POST request</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>user_name</code></td><td>The username of the new user.  Must be between 1 and 25 characters long, letters and numbers only (no whitespace)</td></tr>
        <tr><td><code>display_name</code></td><td>The display name of the new user.  Could be used, for example, to store a user's real name.  Must be between 1 and 50 characters long.</td></tr>
        <tr><td><code>email</code></td><td>The user's email address.  Required for sending activation and password recovery emails.  Must be between 1 and 150 characters and a valid email format.</td></tr>
        <tr><td><code>[title]</code></td><td>The new user's title.  Can only be specified in admin mode.  In registration mode, the default title for new users (in <strong>site settings</strong>) will be used for the user's title.  Must be between 1 and 150 characters long.</td></tr>
        <tr><td><code>password</code></td><td>The password for the new user.  Must be between 8 and 50 characters.</td></tr>
        <tr><td><code>passwordc</code></td><td>The password for the new user.  Must match the `password` field.</td></tr>
        <tr><td><code>[admin]</code></td><td>If specified and set to <b>true</b>, will put the request through in admin mode.</td></tr>
        <tr><td><code>[add_groups]</code></td><td>A comma-separated string of <code>group_id</code>'s to be associated with the new user.  Will only be accepted in admin mode.</td></tr>
        <tr><td><code>[csrf_token]</code></td><td>The csrf token for the user's session.  In admin mode, must be set or the request will automatically fail.</td></tr>
        <tr><td><code>[skip_activation]</code></td><td>If set to <b>true</b>, will skip the activation step for the new user account.  Will only be recognized in admin mode.</td></tr>
        <tr><td><code>[primary_group_id]</code></td><td>The <code>group_id</code> of the primary group for the new user.  Will only be recognized in admin mode.</td></tr>
        
        <tr><td><code>[captcha]</code></td><td>The captcha code displayed on the registration form.  In registration mode, must be specified and correctly match the registration captcha or else the request will automatically fail.</td></tr>
        <tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
        </tbody>
        </table>
        <p><strong>POST response</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
        <tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
        </tbody>
        </table>    
        <p><strong>Possible alerts generated</strong></p>
        <ul class="list-group">
            <li class="list-group-item"><code>ACCOUNT_USER_CHAR_LIMIT</code> : Username too short/long.</li>
            <li class="list-group-item"><code>ACCOUNT_USER_INVALID_CHARACTERS</code> : Username must be letters and numbers only.</li>
            <li class="list-group-item"><code>ACCOUNT_USERNAME_IN_USE</code> : Username already in use.</li>
            <li class="list-group-item"><code>ACCOUNT_DISPLAY_CHAR_LIMIT</code> : Display name too short/long.</li>
            <li class="list-group-item"><code>ACCOUNT_DISPLAYNAME_IN_USE</code> : Display name already in use.  TODO: relax this restriction?</li>
            <li class="list-group-item"><code>ACCOUNT_PASS_CHAR_LIMIT</code> : Password too short/long.</li>            
            <li class="list-group-item"><code>ACCOUNT_PASS_MISMATCH</code> : <code>password</code> and <code>passwordc</code> do not match.</li>
            <li class="list-group-item"><code>ACCOUNT_INVALID_EMAIL</code> : Email is not a valid email address format.</li>
            <li class="list-group-item"><code>ACCOUNT_EMAIL_IN_USE</code> : Email address already in use.</li>
            <li class="list-group-item"><code>MAIL_ERROR</code> : Error sending activation email (if in registration mode).</li>
            <li class="list-group-item"><code>CAPTCHA_FAIL</code> : Captcha did not match. (if in registration mode).</li>
            <li class="list-group-item"><code>ACCOUNT_CREATION_COMPLETE</code> : Successfully completed user account setup.</li>   
            <li class="list-group-item"><code>ACCOUNT_REGISTRATION_COMPLETE_TYPE1</code> : Successfully created user account (no activation required).</li>
            <li class="list-group-item"><code>ACCOUNT_REGISTRATION_COMPLETE_TYPE2</code> : Successfully created user account (activation required).</li>               
            <li class="list-group-item"><code>ACCOUNT_PERMISSION_ADDED</code> : Successfully added user to groups (if in admin mode).</li>
            <li class="list-group-item"><code>NO_DATA</code> : No request data was received by the script.</li>
            <li class="list-group-item"><code>SQL_ERROR</code> : Database error.</li>
            <li class="list-group-item">Authorization failed</li>
        </ul>
      </div>
    </div>
  </div>
  
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#api_pages" href="#delete_action_permit">
          delete_action_permit.php
        </a>
      </h4>
    </div>
    <div id="delete_action_permit" class="panel-collapse collapse">
      <div class="panel-body">
        <p class="lead">
        Delete an action-permit mapping for a user or group.
        </p>
        <p><strong>Login required: </strong>yes</p>
        <p><strong>POST request</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>type</code></td><td>The type of action-permit to delete.  Must be set to either <b>user</b> or <b>group</b>.</td></tr>
        <tr><td><code>action_id</code></td><td>The id of the action-permit to delete (in either the <code>user_action_permits</code> or <code>group_action_permits</code> table).</td></tr>
        <tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
        </tbody>
        </table>
        <p><strong>POST response</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
        <tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
        </tbody>
        </table>    
        <p><strong>Possible alerts generated</strong></p>
        <ul class="list-group">
            <li class="list-group-item"><code>SQL_ERROR</code> : Database error.</li>
            <li class="list-group-item">Invalid type specified.</li>
            <li class="list-group-item">Invalid action id specified.</li>
            <li class="list-group-item">Successfully deleted action-permit mapping.</li>
            <li class="list-group-item">Authorization failed</li>
        </ul>
      </div>
    </div>
  </div>
      
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#api_pages" href="#delete_group">
          delete_group.php
        </a>
      </h4>
    </div>
    <div id="delete_group" class="panel-collapse collapse">
      <div class="panel-body">
        <p class="lead">
        Delete a group.  Groups which have their <code>can_delete</code> field in the database set to <b>0</b> cannot be deleted.  This is useful for certain default groups, such as users and admins.
        </p>
        <p><strong>Login required: </strong>yes</p>
        <p><strong>POST request</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>group_id</code></td><td>The id of the group to delete (in the <code>groups</code> table).</td></tr>
        <tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
        </tbody>
        </table>
        <p><strong>POST response</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
        <tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
        </tbody>
        </table>    
        <p><strong>Possible alerts generated</strong></p>
        <ul class="list-group">
            <li class="list-group-item"><code>SQL_ERROR</code> : Database error.</li>
            <li class="list-group-item"><code>CANNOT_DELETE_PERMISSION_GROUP</code> : Group is not deletable (<code>can_delete</code>=0).</li>
            <li class="list-group-item">Invalid group id specified.</li>
            <li class="list-group-item"><code>PERMISSION_DELETION_SUCCESSFUL_NAME</code> : Group successfully deleted.</li>
            <li class="list-group-item">Authorization failed</li>
        </ul>
      </div>
    </div>
  </div>
  
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#api_pages" href="#delete_user">
          delete_user.php
        </a>
      </h4>
    </div>
    <div id="delete_user" class="panel-collapse collapse">
      <div class="panel-body">
        <p class="lead">
        Permanently delete a user account.  To temporarily disable a user account instead, use the <code>update_user.php</code> api with <code>enabled</code> set to <b>false</b>.  Note also that the root account cannot be deleted.
        </p>
        <p><strong>Login required: </strong>yes</p>
        <p><strong>POST request</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>user_id</code></td><td>The id of the user to delete (in the <code>users</code> table).</td></tr>
        <tr><td><code>ajaxMode</code></td><td>Set to <strong>true</strong> if the request is via ajax, <strong>false</strong> otherwise.</td></tr>
        </tbody>
        </table>
        <p><strong>POST response</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>errors[]</code></td><td>the number of errors generated by the request.</td></tr>
        <tr><td><code>successes[]</code></td><td>the number of successes generated by the request.</td></tr>
        </tbody>
        </table>    
        <p><strong>Possible alerts generated</strong></p>
        <ul class="list-group">
            <li class="list-group-item"><code>SQL_ERROR</code> : Database error.</li>
            <li class="list-group-item"><code>ACCOUNT_DELETE_MASTER</code> : The root account cannot be deleted.</li>
            <li class="list-group-item">Invalid user id specified.</li>
            <li class="list-group-item"><code>ACCOUNT_DELETIONS_SUCCESSFUL</code> : User account successfully deleted.</li>
            <li class="list-group-item">Authorization failed</li>
        </ul>
      </div>
    </div>
  </div>
  
  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#api_pages" href="#load_action_permits">
          load_action_permits.php
        </a>
      </h4>
    </div>
    <div id="load_action_permits" class="panel-collapse collapse">
      <div class="panel-body">
        <p class="lead">
        Load a list of action-permits for one or more user(s) or group(s).
        </p>
        <p><strong>Login required: </strong>yes</p>
        <p><strong>AJAX only: </strong>yes</p>
        <p><strong>GET request</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code>[user_id]</code></td><td>If specified, loads a list of action-permits for the specified user.</td></tr>
        <tr><td><code>[group_id]</code></td><td>If specified, loads a list of action-permits for the specified group.</td></tr>
        <tr><td><code>[all]</code></td><td>If set to <b>users</b>, loads a list of action-permits for all users.  If set to <b>groups</b>, loads a list of action-permits for all groups.  Must be specified if neither <code>user_id</code> nor <code>group_id</code> is specified.</td></tr>        
        <tr><td><code>[pretty]</code></td><td>If set to <b>true</b>, will output the resulting JSON object in a formatted and indented display.</td></tr>
        </tbody>
        </table>
        <p><strong>GET response</strong></p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>
        <tr><td><code><i>JSON array</i></code></td><td>If <code>all</code> is specified, an array of objects representing groups and their associated action-permit mappings will be returned.  Each group will look something like the following code block.  Note that <code>action_permits</code> contains the array of action-permit mappings for the group.  Each action-permit mapping, in turn, contains the action name and an object containing associated permits.  Each permit, finally, consists of the permit validator name and an array of associated parameters.
        <pre>
{
    "group_id": 1,
    "name": "User",
    "action_permits": [
        {
            "action_id": 3,
            "action": "loadUser",
            "permits": {
                "isLoggedInUser": [
                    "user_id"
                ]
            }
        },
        {
            "action_id": 1,
            "action": "updateUserEmail",
            "permits": {
                "isLoggedInUser": [
                    "user_id"
                ]
            }
        },
        ...
    ]
}
        </pre>
        If a <code>user_id</code> or <code>group_id</code> is specified, an array of action-permit objects will be returned.  In this mode, the permit strings will not be parsed out into their constituent validator functions.
        <pre>
[
	{
		"id": 3,
		"group_id": 1,
		"action": "loadUser",
		"permits": "isLoggedInUser(user_id)"
	},
	{
		"id": 4,
		"group_id": 1,
		"action": "loadUserGroups",
		"permits": "isLoggedInUser(user_id)"
	},
    ...
]
        </pre>
        </td></tr>
        <tr><td><code>[errors[]]</code></td><td>the number of errors generated by the request, if it failed.</td></tr>
        </tbody>
        </table>    
        <p><strong>Possible alerts generated</strong></p>
        <ul class="list-group">
            <li class="list-group-item"><code>SQL_ERROR</code> : Database error.</li>
            <li class="list-group-item"><code>user_id</code>, <code>group_id</code>, or <code>all</code> must be specified.</li>
            <li class="list-group-item">Invalid user_id, group_id, or all value specified.</li>
            <li class="list-group-item">Authorization failed</li>
        </ul>
      </div>
    </div>
  </div>    

  <div class="panel panel-default">
    <div class="panel-heading">
      <h4 class="panel-title">
        <a data-toggle="collapse" data-parent="#api_pages" href="#load_current_user">
          load_current_user.php
        </a>
      </h4>
    </div>
    <div id="load_current_user" class="panel-collapse collapse">
      <div class="panel-body">
        <p class="lead">
        Load the currently logged-in user's information.
        </p>
        <p><strong>Login required: </strong>yes</p>
        <p><strong>AJAX only: </strong>yes</p>
        <p><strong>GET request</strong></p>
        <div class="well"><i>No parameters</i></div>
        <p><strong>GET response</strong></p>
        <p>A JSON object containing the following fields for the user's account:</p>
        <table class="table table-bordered">
        <thead><td>Variable name</td><td>Description</td></thead>
        <tbody>        
        <tr><td><code>user_id</code></td><td>The id of the currently logged in user.</td></tr>
        <tr><td><code>user_name</code></td><td>The username of the currently logged in user.</td></tr>
        <tr><td><code>display_name</code></td><td>The display name of the currently logged in user.</td></tr>
        <tr><td><code>title</code></td><td>The title of the currently logged in user.</td></tr>
        <tr><td><code>email</code></td><td>The email address of the currently logged in user.</td></tr>
        <tr><td><code>sign_up_stamp</code></td><td>The UNIX timestamp (seconds since Jan 1, 1970) of the time when the currently logged in user's account was created.</td></tr>
        <tr><td><code>last_sign_in_stamp</code></td><td>The UNIX timestamp (seconds since Jan 1, 1970) of the time when the currently logged in user's last logged in.</td></tr>
        <tr><td><code>active</code></td><td><b>1</b> if the user's account is active, <b>0</b> otherwise.</td></tr>
        <tr><td><code>enabled</code></td><td><b>1</b> if the user's account is enabled, <b>0</b> otherwise.</td></tr>
        <tr><td><code>primary_group_id</code></td><td>The <code>group_id</code> of the user's primary group.</td></tr>
        <tr><td><code>csrf_token</code></td><td>The currently logged in user's <a href="security.html#csrf">CSRF token</a>.</td></tr>
        </tbody>
        </table>
        <p><strong>Possible alerts generated</strong></p>
        <ul class="list-group">
            <li class="list-group-item"><code>SQL_ERROR</code> : Database error.</li>
            <li class="list-group-item">User is not logged in.</li>
        </ul>
      </div>
    </div>
  </div>    
  
</div>

